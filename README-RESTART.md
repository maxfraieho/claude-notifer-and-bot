# Universal Bot Restart Script

## üìã –û–≥–ª—è–¥

`bot-restart.sh` - —Ü–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫—É —Ç–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É Claude Code Telegram –±–æ—Ç–∞. –í—ñ–Ω –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —Å–µ—Å—ñ–π —Ç–∞ —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–æ–≤–æ—ó —ñ–Ω—Å—Ç–∞–Ω—Ü—ñ—ó –±–æ—Ç–∞.

## ‚ú® –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- ‚úÖ **–ü–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è** - –≤–±–∏–≤–∞—î –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ –ø—Ä–æ—Ü–µ—Å–∏ –±–æ—Ç–∞
- ‚úÖ **–û—á–∏—â–µ–Ω–Ω—è —Å–µ—Å—ñ–π** - –∑–∞–∫—Ä–∏–≤–∞—î –≤—Å—ñ background bash —Å–µ—Å—ñ—ó
- ‚úÖ **–û—á–∏—â–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤** - –≤–∏–¥–∞–ª—è—î —Ç–∏–º—á–∞—Å–æ–≤—ñ —Ñ–∞–π–ª–∏ —Ç–∞ restart info
- ‚úÖ **–†–µ–∂–∏–º –µ–∫–æ–Ω–æ–º—ñ—ó –ø–∞–º'—è—Ç—ñ** - –∑–∞–ø—É—Å–∫–∞—î –∑ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ Python
- ‚úÖ **Poetry —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Poetry –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏
- ‚úÖ **–ë–µ–∑–ø–µ—á–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è** - —Å–ø–æ—á–∞—Ç–∫—É graceful shutdown, –ø–æ—Ç—ñ–º force kill

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ó–∞–ø—É—Å–∫ –∑ –∫–æ–Ω—Å–æ–ª—ñ

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É
cd /home/vokov/projects/claude-notifer-and-bot

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Å–∫—Ä–∏–ø—Ç
./bot-restart.sh
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑ Telegram

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/restart` –≤ –±–æ—Ç—ñ. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. –ó–±–µ—Ä–µ–∂–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
2. –í–∏–∫–æ–Ω–∞—î `bot-restart.sh`
3. –ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –ø–æ–∫–∞–∂–µ –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –º–µ–Ω—é —Å—Ç–∞—Ä—Ç—É

## ‚öôÔ∏è –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –ø–∞–º'—è—Ç—ñ

–°–∫—Ä–∏–ø—Ç –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –Ω–∞—Å—Ç—É–ø–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:

```bash
export PYTHONOPTIMIZE=1          # –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –±–∞–π—Ç-–∫–æ–¥–∏
export PYTHONDONTWRITEBYTECODE=1 # –ù–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ .pyc —Ñ–∞–π–ª–∏
export PYTHONMALLOC=malloc       # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–π malloc
export MALLOC_TRIM_THRESHOLD_=100000  # –ê–≥—Ä–µ—Å–∏–≤–Ω–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
```

–ó–∞–ø—É—Å–∫–∞—î Python –∑ —Ñ–ª–∞–≥–æ–º `-O` –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó.

## üîç –ü—Ä–æ—Ü–µ—Å –æ—á–∏—â–µ–Ω–Ω—è

1. **–ü–æ—à—É–∫ –ø—Ä–æ—Ü–µ—Å—ñ–≤** - –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ –ø—Ä–æ—Ü–µ—Å–∏ `python.*src.main`
2. **Graceful shutdown** - –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î SIGTERM
3. **Force kill** - —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î SIGKILL
4. **–û—á–∏—â–µ–Ω–Ω—è background —Å–µ—Å—ñ–π** - –∑–∞–∫—Ä–∏–≤–∞—î –≤–∏—Å—è—á—ñ bash –ø—Ä–æ—Ü–µ—Å–∏
5. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞** - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î —â–æ –≤—Å—ñ –ø—Ä–æ—Ü–µ—Å–∏ –∑–∞–∫—Ä–∏—Ç—ñ
6. **–û—á–∏—â–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤** - –≤–∏–¥–∞–ª—è—î —Ç–∏–º—á–∞—Å–æ–≤—ñ —Ñ–∞–π–ª–∏

## üìù –õ–æ–≥ –≤–∏–≤–æ–¥—É

–°–∫—Ä–∏–ø—Ç –Ω–∞–¥–∞—î –¥–µ—Ç–∞–ª—å–Ω–∏–π –ª–æ–≥:

```
üîÑ Universal Bot Restart Script
===============================
‚ö†Ô∏è  Running as root - this is normal in containers
Thu Sep 25 08:42:48 UTC 2025: Starting bot restart procedure...
üîç Looking for bot processes...
üìã Found PIDs: 18841
‚èπÔ∏è  Attempting graceful shutdown...
üíÄ Force killing remaining processes: 18841
‚úÖ Cleaned up bot processes
üßπ Cleaning up background bash sessions...
‚úÖ Background sessions cleaned
üîç Verifying cleanup...
‚úÖ All bot processes stopped
üóëÔ∏è  Cleaning temporary files...
‚úÖ Temporary files cleaned
‚è≥ Waiting for system cleanup...
üöÄ Starting bot with memory optimization...
üîß Environment configured for memory optimization
üîÑ Starting bot...
```

## üîÑ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –∫–æ–º–∞–Ω–¥–æ—é /restart

–ö–æ–º–∞–Ω–¥–∞ `/restart` –≤ –±–æ—Ç—ñ —Ç–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü–µ–π —Å–∫—Ä–∏–ø—Ç:

1. –ó–±–µ—Ä—ñ–≥–∞—î restart info –≤ `/tmp/claude_bot_restart_info.json`
2. –í–∏–∫–ª–∏–∫–∞—î `bot-restart.sh` —á–µ—Ä–µ–∑ `os.execl()`
3. –°–∫—Ä–∏–ø—Ç –æ—á–∏—â—É—î –≤—Å–µ —ñ –∑–∞–ø—É—Å–∫–∞—î –±–æ—Ç–∞
4. –ë–æ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ —á–∏—Ç–∞—î restart info —ñ –ø–æ–∫–∞–∑—É—î –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –º–µ–Ω—é

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- –°–∫—Ä–∏–ø—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Ä–æ–±–æ—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (root –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á)
- –í–∏–º–∞–≥–∞—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å `pyproject.toml` —Ç–∞ `src/main.py`
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Poetry –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î PATH –¥–ª—è Poetry

## üêõ –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è

–Ø–∫—â–æ –±–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≤–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ `pyproject.toml` —ñ—Å–Ω—É—î
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ Poetry –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π
4. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –∑ –º–∞–Ω—É–∞–ª—å–Ω–∏–º –ª–æ–≥—É–≤–∞–Ω–Ω—è–º: `./bot-restart.sh 2>&1 | tee restart.log`

## üìÅ –§–∞–π–ª–∏

- `bot-restart.sh` - –æ—Å–Ω–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
- `/tmp/claude_bot_restart_info.json` - —Ç–∏–º—á–∞—Å–æ–≤—ñ –¥–∞–Ω—ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
- `src/bot/handlers/command.py` - —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∫–æ–º–∞–Ω–¥–∏ `/restart`
- `src/bot/core.py` - –æ–±—Ä–æ–±–∫–∞ restart info –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ