version: "1.0"
name: "Claude Code Bot System Analysis"
description: "DRACON —Å—Ö–µ–º–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ —Ç–∞ –ª–æ–≥—ñ–∫–∏ Claude Code Telegram Bot"

metadata:
  author: "Enhanced DRACON System"
  created: "2024-12-19"
  version: "1.0.0"
  category: "system_analysis"
  complexity: "enterprise"

  analysis_data:
    total_files_analyzed: 4303
    critical_issues: 21
    high_priority_issues: 1870
    medium_priority_issues: 2410
    low_priority_issues: 2

canvas:
  width: 1600
  height: 1200
  grid_size: 50
  theme: "enterprise"
  zoom: 0.8

nodes:
  # === ENTRY POINTS ===
  - id: "telegram_webhook"
    type: "title"
    name: "Telegram Webhook"
    description: "–û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ Telegram API"
    position: [100, 100]
    size: [160, 80]
    properties:
      text: "üì° Telegram Update"
      color: "#4a90e2"
      icon: "webhook"

  - id: "user_authentication"
    type: "question"
    name: "–ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
    description: "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
    position: [350, 100]
    size: [180, 100]
    properties:
      text: "üîê –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É"
      condition: "user_id in whitelist OR valid_token"
      color: "#f5a623"

  - id: "reject_access"
    type: "end"
    name: "–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É"
    description: "–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
    position: [200, 250]
    size: [140, 60]
    properties:
      text: "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ"
      color: "#d0021b"

  # === COMMAND ROUTING ===
  - id: "command_router"
    type: "case"
    name: "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è –∫–æ–º–∞–Ω–¥"
    description: "–†–æ–∑–ø–æ–¥—ñ–ª –∫–æ–º–∞–Ω–¥ –ø–æ –æ–±—Ä–æ–±–Ω–∏–∫–∞–º"
    position: [600, 100]
    size: [200, 120]
    properties:
      text: "üéØ –†–æ–∑–ø–æ–¥—ñ–ª –∫–æ–º–∞–Ω–¥"
      cases: ["navigation", "session", "dracon", "mcp", "system"]
      color: "#9013fe"

  # === NAVIGATION COMMANDS ===
  - id: "navigation_handler"
    type: "action"
    name: "–ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω—ñ –∫–æ–º–∞–Ω–¥–∏"
    description: "–û–±—Ä–æ–±–∫–∞ –∫–æ–º–∞–Ω–¥ —Ñ–∞–π–ª–æ–≤–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó"
    position: [100, 350]
    size: [180, 100]
    properties:
      text: "üìÅ –ù–∞–≤—ñ–≥–∞—Ü—ñ—è"
      commands: ["/ls", "/cd", "/pwd", "/projects"]
      template: "–û–ø–µ—Ä–∞—Ü—ñ—ó –∑ —Ñ–∞–π–ª–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é"
      color: "#7ed321"

  - id: "security_validation"
    type: "question"
    name: "–í–∞–ª—ñ–¥–∞—Ü—ñ—è –±–µ–∑–ø–µ–∫–∏"
    description: "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —à–ª—è—Ö—ñ–≤ —Ñ–∞–π–ª—ñ–≤ –Ω–∞ –±–µ–∑–ø–µ–∫—É"
    position: [100, 500]
    size: [180, 80]
    properties:
      text: "üõ°Ô∏è –í–∞–ª—ñ–¥–∞—Ü—ñ—è —à–ª—è—Ö—ñ–≤"
      condition: "path_is_safe AND within_approved_dir"
      color: "#f5a623"

  # === SESSION MANAGEMENT ===
  - id: "session_handler"
    type: "action"
    name: "–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏"
    description: "–û–±—Ä–æ–±–∫–∞ Claude —Å–µ—Å—ñ–π"
    position: [350, 350]
    size: [180, 100]
    properties:
      text: "üîÑ Claude Sessions"
      commands: ["/new", "/continue", "/status", "/export"]
      template: "–û–ø–µ—Ä–∞—Ü—ñ—ó –∑ Claude CLI/SDK"
      color: "#7ed321"

  - id: "claude_integration"
    type: "case"
    name: "Claude —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è"
    description: "–í–∏–±—ñ—Ä –º—ñ–∂ CLI —Ç–∞ SDK"
    position: [350, 500]
    size: [180, 100]
    properties:
      text: "‚öôÔ∏è CLI vs SDK"
      cases: ["cli_mode", "sdk_mode", "fallback"]
      color: "#9013fe"

  # === DRACON SYSTEM ===
  - id: "dracon_handler"
    type: "action"
    name: "DRACON —Å–∏—Å—Ç–µ–º–∞"
    description: "–û–±—Ä–æ–±–∫–∞ DRACON –∫–æ–º–∞–Ω–¥"
    position: [600, 350]
    size: [200, 120]
    properties:
      text: "üé® DRACON System"
      commands: ["/dracon", "/refactor"]
      features: ["visual_diagrams", "code_generation", "reverse_engineering"]
      template: "–í—ñ–∑—É–∞–ª—å–Ω–µ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –±–æ—Ç–∞"
      color: "#50e3c2"

  - id: "dracon_parser"
    type: "action"
    name: "DRACON Parser"
    description: "–ü–∞—Ä—Å–∏–Ω–≥ YAML —Å—Ö–µ–º"
    position: [450, 500]
    size: [160, 80]
    properties:
      text: "üìù YAML Parser"
      features: ["syntax_validation", "semantic_analysis"]
      color: "#7ed321"

  - id: "dracon_renderer"
    type: "action"
    name: "–í—ñ–∑—É–∞–ª—å–Ω–∏–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä"
    description: "–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è SVG/PNG –¥—ñ–∞–≥—Ä–∞–º"
    position: [650, 500]
    size: [160, 80]
    properties:
      text: "üé® Visual Renderer"
      output_formats: ["svg", "png"]
      color: "#7ed321"

  - id: "dracon_generator"
    type: "action"
    name: "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–¥—É"
    description: "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Python –∫–æ–¥—É –∑ —Å—Ö–µ–º"
    position: [850, 500]
    size: [160, 80]
    properties:
      text: "‚öôÔ∏è Code Generator"
      templates: ["jinja2", "telegram_bot"]
      color: "#7ed321"

  # === MCP SYSTEM ===
  - id: "mcp_handler"
    type: "action"
    name: "MCP —Å–∏—Å—Ç–µ–º–∞"
    description: "Model Context Protocol –æ–±—Ä–æ–±–∫–∞"
    position: [900, 350]
    size: [180, 100]
    properties:
      text: "üîó MCP Protocol"
      commands: ["/mcpadd", "/mcplist", "/mcpselect"]
      features: ["external_tools", "context_management"]
      color: "#50e3c2"

  # === SYSTEM COMMANDS ===
  - id: "system_handler"
    type: "action"
    name: "–°–∏—Å—Ç–µ–º–Ω—ñ –∫–æ–º–∞–Ω–¥–∏"
    description: "–°–∏—Å—Ç–µ–º–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±–æ—Ç–æ–º"
    position: [1150, 350]
    size: [180, 100]
    properties:
      text: "‚öôÔ∏è System Control"
      commands: ["/restart", "/help", "/actions"]
      color: "#7ed321"

  # === AUDIT AND MONITORING ===
  - id: "audit_logger"
    type: "action"
    name: "–ê—É–¥–∏—Ç —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è"
    description: "–ó–∞–ø–∏—Å –æ–ø–µ—Ä–∞—Ü—ñ–π –¥–ª—è –±–µ–∑–ø–µ–∫–∏"
    position: [100, 700]
    size: [200, 80]
    properties:
      text: "üìä Audit Logging"
      features: ["command_tracking", "security_events"]
      color: "#b8e986"

  - id: "rate_limiter"
    type: "question"
    name: "–û–±–º–µ–∂–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ"
    description: "–ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç–∏ –∑–∞–ø–∏—Ç—ñ–≤"
    position: [350, 700]
    size: [180, 80]
    properties:
      text: "‚è±Ô∏è Rate Limiting"
      condition: "requests_per_minute < limit"
      color: "#f5a623"

  # === ERROR HANDLING ===
  - id: "error_handler"
    type: "action"
    name: "–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫"
    description: "–¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫"
    position: [600, 700]
    size: [200, 100]
    properties:
      text: "üö® Error Handler"
      issues_found:
        critical: 21
        high: 1870
        medium: 2410
      features: ["safe_user_error", "structured_logging"]
      color: "#d0021b"

  # === LOCALIZATION ===
  - id: "localization"
    type: "action"
    name: "–õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è"
    description: "–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±–∞–≥–∞—Ç—å–æ—Ö –º–æ–≤"
    position: [850, 700]
    size: [180, 80]
    properties:
      text: "üåê Localization"
      languages: ["uk", "en"]
      issues: "hardcoded_buttons_detected"
      color: "#f5a623"

  # === STORAGE ===
  - id: "storage_system"
    type: "action"
    name: "–°–∏—Å—Ç–µ–º–∞ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è"
    description: "–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Ç–∞ —Ñ–∞–π–ª–∏"
    position: [1100, 700]
    size: [180, 100]
    properties:
      text: "üíæ Storage"
      components: ["sqlite_db", "file_system", "dracon_categories"]
      color: "#7ed321"

  # === RESPONSE GENERATION ===
  - id: "response_formatter"
    type: "action"
    name: "–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π"
    description: "–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É"
    position: [600, 900]
    size: [200, 80]
    properties:
      text: "üì§ Response Format"
      formats: ["text", "markdown", "images", "files"]
      color: "#7ed321"

  - id: "telegram_send"
    type: "end"
    name: "–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Telegram"
    description: "–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É"
    position: [900, 900]
    size: [160, 60]
    properties:
      text: "üì® Send Response"
      color: "#4a90e2"

edges:
  # Main flow
  - id: "webhook_to_auth"
    from_node: "telegram_webhook"
    to_node: "user_authentication"
    type: "sequence"
    label: "Incoming message"

  - id: "auth_reject"
    from_node: "user_authentication"
    to_node: "reject_access"
    type: "false"
    label: "Unauthorized"

  - id: "auth_success"
    from_node: "user_authentication"
    to_node: "command_router"
    type: "true"
    label: "Authorized"

  # Command routing
  - id: "route_navigation"
    from_node: "command_router"
    to_node: "navigation_handler"
    type: "case_branch"
    label: "Navigation commands"

  - id: "route_session"
    from_node: "command_router"
    to_node: "session_handler"
    type: "case_branch"
    label: "Session commands"

  - id: "route_dracon"
    from_node: "command_router"
    to_node: "dracon_handler"
    type: "case_branch"
    label: "DRACON commands"

  - id: "route_mcp"
    from_node: "command_router"
    to_node: "mcp_handler"
    type: "case_branch"
    label: "MCP commands"

  - id: "route_system"
    from_node: "command_router"
    to_node: "system_handler"
    type: "case_branch"
    label: "System commands"

  # Navigation flow
  - id: "nav_to_security"
    from_node: "navigation_handler"
    to_node: "security_validation"
    type: "sequence"
    label: "Path validation"

  # Session flow
  - id: "session_to_claude"
    from_node: "session_handler"
    to_node: "claude_integration"
    type: "sequence"
    label: "Claude processing"

  # DRACON flow
  - id: "dracon_to_parser"
    from_node: "dracon_handler"
    to_node: "dracon_parser"
    type: "sequence"
    label: "Parse YAML"

  - id: "dracon_to_renderer"
    from_node: "dracon_handler"
    to_node: "dracon_renderer"
    type: "sequence"
    label: "Generate diagram"

  - id: "dracon_to_generator"
    from_node: "dracon_handler"
    to_node: "dracon_generator"
    type: "sequence"
    label: "Generate code"

  # Cross-cutting concerns
  - id: "all_to_audit"
    from_node: "command_router"
    to_node: "audit_logger"
    type: "sequence"
    label: "Log all operations"

  - id: "all_to_rate_limit"
    from_node: "command_router"
    to_node: "rate_limiter"
    type: "sequence"
    label: "Check rate limits"

  - id: "rate_limit_fail"
    from_node: "rate_limiter"
    to_node: "error_handler"
    type: "false"
    label: "Rate exceeded"

  # Response flow
  - id: "nav_to_response"
    from_node: "security_validation"
    to_node: "response_formatter"
    type: "true"
    label: "Safe operation"

  - id: "session_to_response"
    from_node: "claude_integration"
    to_node: "response_formatter"
    type: "sequence"
    label: "Claude response"

  - id: "dracon_to_response"
    from_node: "dracon_parser"
    to_node: "response_formatter"
    type: "sequence"
    label: "DRACON result"

  - id: "mcp_to_response"
    from_node: "mcp_handler"
    to_node: "response_formatter"
    type: "sequence"
    label: "MCP result"

  - id: "system_to_response"
    from_node: "system_handler"
    to_node: "response_formatter"
    type: "sequence"
    label: "System response"

  - id: "response_to_send"
    from_node: "response_formatter"
    to_node: "telegram_send"
    type: "sequence"
    label: "Send to user"

  # Error flows
  - id: "security_fail"
    from_node: "security_validation"
    to_node: "error_handler"
    type: "false"
    label: "Security violation"

  - id: "error_to_response"
    from_node: "error_handler"
    to_node: "response_formatter"
    type: "sequence"
    label: "Error message"

validation_rules:
  no_intersections: true
  single_entry_exit: true
  all_paths_covered: true
  variable_scope_check: true

macros:
  - name: "command_processing"
    parameters: ["command_type", "handler"]
    definition:
      description: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –º–∞–∫—Ä–æ—Å –æ–±—Ä–æ–±–∫–∏ –∫–æ–º–∞–Ω–¥"
      steps: ["validation", "processing", "response", "audit"]

dracon_metadata:
  complexity_metrics:
    total_nodes: 19
    total_edges: 22
    max_depth: 4
    cyclomatic_complexity: 12

  system_analysis:
    architecture_style: "layered_with_middleware"
    security_level: "enterprise"
    scalability: "high"
    maintainability: "good_with_issues"

  audit_findings:
    critical_issues: 21
    main_problems:
      - "Silent exception handling (except: pass)"
      - "Hardcoded button texts"
      - "Missing localization"
    recommendations:
      - "Implement proper error handling"
      - "Move hardcoded texts to localization files"
      - "Add comprehensive testing"
      - "Improve documentation"